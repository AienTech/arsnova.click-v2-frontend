<div class="row d-flex flex-wrap mb-md-2">

  <div class="d-flex col-12 col-md-auto mb-3 mb-md-0 text-nowrap">
    <span class="d-inline-flex align-items-center">Current Project:</span>
    <select #projectSelect
            (change)="setProject(projectSelect.value)"
            class="border-0 custom-select custom-select-sm ml-2">
      <option [value]="projectLoaderService.projects.Frontend">Frontend
      </option>
      <option [value]="projectLoaderService.projects.Backend">Backend
      </option>
    </select>

    <span [class.badge-danger]="!this.projectLoaderService.connected"
          [class.badge-warning]="this.projectLoaderService.connected"
          class="d-inline-flex ml-2 align-items-center badge">
      <span *ngIf="!this.projectLoaderService.connected">Not&nbsp;</span>
      <span>Loaded</span>
      <span *ngIf="this.projectLoaderService.connected && !this.userService.staticLoginTokenContent.gitlabToken"
            class="text-danger">&nbsp;(Readonly - No Gitlab API Token set for user)</span>
    </span>
  </div>

  <div *ngIf="this.projectLoaderService.connected"
       class="d-flex col-12 col-md mb-3 mb-md-0">
    <label class="d-inline-flex mx-md-2 align-items-center mb-0">
      <span class="mr-2">Show unused keys</span>
      <input type="checkbox"
             [(ngModel)]="unusedKeyFilter"/>
    </label>
  </div>

  <div *ngIf="this.projectLoaderService.connected"
       class="col-12 col-md mb-3 mb-md-0">
    <div class="btn-group ml-md-auto">
      <button class="btn btn-secondary"
              [disabled]="!this.languageLoaderService.changedData"
              [title]="!this.userService.staticLoginTokenContent.gitlabToken ? 'No gitlab token set' : ''"
              (click)="updateData()"><span>Save Changes</span>
      </button>
      <button class="btn btn-secondary"
              (click)="modalOrganizerService.addKey()">
        <span>Add Key</span>
      </button>
    </div>
  </div>
</div>

<div *ngIf="this.projectLoaderService.connected"
     class="row">
  <div class="d-flex sticky-top col-12 my-2">
    <div class="bg-secondary d-flex w-100 py-1">
      <select #filterSelect
              (change)="changeFilter(filterSelect.value)"
              class="border-0 bg-transparent mr-2">
        <option [value]="filters.None"
                [selected]="filter === filters.None">No Filter
        </option>
        <option [value]="filters.InvalidKeys"
                [selected]="filter === filters.InvalidKeys">Empty Keys
        </option>
        <option [value]="filters.InvalidDE"
                [selected]="filter === filters.InvalidDE">Empty DE Keys
        </option>
        <option [value]="filters.InvalidEN"
                [selected]="filter === filters.InvalidEN">Empty EN Keys
        </option>
        <option [value]="filters.InvalidES"
                [selected]="filter === filters.InvalidES">Empty ES Keys
        </option>
        <option [value]="filters.InvalidFr"
                [selected]="filter === filters.InvalidFr">Empty FR Keys
        </option>
        <option [value]="filters.InvalidIt"
                [selected]="filter === filters.InvalidIt">Empty IT Keys
        </option>
      </select>
      <input type="text"
             class="d-flex flex-grow-1 border-0"
             #searchBox
             [value]="searchFilter"
             (keyup)="searchFilter = (searchBox.value)"
             placeholder="Search..."/>
    </div>
  </div>

  <div class="col-12 key-list overflow-auto"
       [class.col-sm-6]="!!selectedKey">
    <app-key-output [filter]="filter"
                    [unusedKeyFilter]="unusedKeyFilter"
                    [searchFilter]="searchFilter"
                    (changeEmitter)="dataChanged($event)"></app-key-output>
  </div>
  <div class="col-12 col-sm-6 d-flex flex-column h-100 sticky-top"
       style="top: 50px;"
       *ngIf="!!selectedKey">
    <p class="mb-0 text-center text-warning"
       *ngIf="isUnusedKey()">This key is currently unused!</p>
    <div class="d-flex flex-column flex-grow-1 mb-2"
         *ngFor="let langKey of getKeys(languageLoaderService.language)">
      <p class="mb-0">{{languageLoaderService.languageTranslation[langKey.toUpperCase()]}}</p>
      <textarea class="w-100 key-textarea flex-grow-1"
                [disabled]="!this.userService.staticLoginTokenContent.gitlabToken"
                [class.cursor-not-allowed]="!this.userService.staticLoginTokenContent.gitlabToken"
                [title]="!this.userService.staticLoginTokenContent.gitlabToken ? 'No gitlab token set' : ''"
                (keyup)="updateKey($event, langKey.toLowerCase(), selectedKey)"
                [value]="selectedKey?.value[langKey.toLowerCase()] || ''"></textarea>
    </div>
  </div>
</div>

<h5 *ngIf="loading"
    class="text-center mt-5">Loading...</h5>
<h5 *ngIf="error"
    class="alert alert-danger mt-5 text-center">
  <span *ngIf="unauthorized">Not authorized to view this project</span>
  <span *ngIf="!unauthorized">Error while loading the project language definition</span>
</h5>
